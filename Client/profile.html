<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>My Profile - Campus ReHome</title>
  
  <!-- Bootstrap 5 CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="./styles/main.css" />
  <style>
    /* Force hide employee navigation items by default - highest priority */
    #furnitureNavItem,
    #customersNavItem,
    #employeesNavItem,
    #transactionsNavItem {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
      height: 0 !important;
      width: 0 !important;
      overflow: hidden !important;
      position: absolute !important;
      left: -9999px !important;
    }
    
    /* Only show for employees when body has employee-user class */
    body.employee-user #furnitureNavItem,
    body.employee-user #customersNavItem,
    body.employee-user #employeesNavItem,
    body.employee-user #transactionsNavItem {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      height: auto !important;
      width: auto !important;
      overflow: visible !important;
      position: static !important;
      left: auto !important;
    }
  </style>
  <script>
    // Run immediately - before page renders
    (function() {
      // Get user type from localStorage immediately
      const userType = localStorage.getItem('userType');
      
      // If not an employee, ensure nav items are never shown
      if (!userType || userType.toLowerCase() !== 'employee') {
        // Add CSS to permanently hide
        const style = document.createElement('style');
        style.textContent = `
          #furnitureNavItem,
          #customersNavItem,
          #employeesNavItem,
          #transactionsNavItem {
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            width: 0 !important;
            overflow: hidden !important;
            margin: 0 !important;
            padding: 0 !important;
          }
        `;
        document.head.appendChild(style);
      }
    })();
  </script>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
      <a class="navbar-brand" href="./index.html">üè† Campus ReHome</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="./index.html">
              <i class="bi bi-house"></i> Home
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="./profile.html">
              <i class="bi bi-person-circle"></i> Profile
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="logout()">
              <i class="bi bi-box-arrow-right"></i> Logout
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container my-4">
    <div class="row">
      <div class="col-md-8 offset-md-2">
        <div class="card shadow">
          <div class="card-header bg-primary text-white">
            <h3 class="mb-0">My Profile</h3>
          </div>
          <div class="card-body">
            <div id="profileLoading" class="text-center py-4">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
            
            <div id="profileContent" style="display: none;">
              <div class="mb-4">
                <h5 class="text-muted">Account Information</h5>
                <hr>
                <div class="row mb-3">
                  <div class="col-sm-4"><strong>User ID:</strong></div>
                  <div class="col-sm-8" id="profileId">-</div>
                </div>
                <div class="row mb-3">
                  <div class="col-sm-4"><strong>Name:</strong></div>
                  <div class="col-sm-8" id="profileName">-</div>
                </div>
                <div class="row mb-3">
                  <div class="col-sm-4"><strong>Email:</strong></div>
                  <div class="col-sm-8" id="profileEmail">-</div>
                </div>
                <div class="row mb-3">
                  <div class="col-sm-4"><strong>Phone:</strong></div>
                  <div class="col-sm-8" id="profilePhone">-</div>
                </div>
                <div id="profileRoleRow" class="row mb-3" style="display: none;">
                  <div class="col-sm-4"><strong>Role:</strong></div>
                  <div class="col-sm-8" id="profileRole">-</div>
                </div>
                <div id="profileAddressRow" class="row mb-3" style="display: none;">
                  <div class="col-sm-4"><strong>Address:</strong></div>
                  <div class="col-sm-8" id="profileAddress">-</div>
                </div>
                <div id="profileHireDateRow" class="row mb-3" style="display: none;">
                  <div class="col-sm-4"><strong>Hire Date:</strong></div>
                  <div class="col-sm-8" id="profileHireDate">-</div>
                </div>
                <div id="profileJoinDateRow" class="row mb-3" style="display: none;">
                  <div class="col-sm-4"><strong>Join Date:</strong></div>
                  <div class="col-sm-8" id="profileJoinDate">-</div>
                </div>
                <div id="profileStatusRow" class="row mb-3" style="display: none;">
                  <div class="col-sm-4"><strong>Status:</strong></div>
                  <div class="col-sm-8" id="profileStatus">-</div>
                </div>
              </div>
              
              <div class="d-grid gap-2">
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editProfileModal">
                  Edit Profile
                </button>
                <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#changePasswordModal">
                  Change Password
                </button>
              </div>
            </div>
            
            <div id="profileError" class="alert alert-danger" style="display: none;"></div>
          </div>
        </div>

        <!-- Transaction History Section (Customers Only) -->
        <div id="transactionHistorySection" class="card shadow mt-4" style="display: none;">
          <div class="card-header bg-primary text-white">
            <h3 class="mb-0">Order History</h3>
          </div>
          <div class="card-body">
            <div id="transactionsLoading" class="text-center py-4">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
            
            <div id="transactionsContent" style="display: none;">
              <div id="transactionsList"></div>
            </div>
            
            <div id="transactionsError" class="alert alert-danger" style="display: none;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="editProfileForm">
            <div class="mb-3">
              <label for="editFirstName" class="form-label">First Name *</label>
              <input type="text" class="form-control" id="editFirstName" required>
            </div>
            <div class="mb-3">
              <label for="editLastName" class="form-label">Last Name *</label>
              <input type="text" class="form-control" id="editLastName" required>
            </div>
            <div class="mb-3">
              <label for="editEmail" class="form-label">Email *</label>
              <input type="email" class="form-control" id="editEmail" required>
            </div>
            <div class="mb-3">
              <label for="editPhone" class="form-label">Phone</label>
              <input type="tel" class="form-control" id="editPhone">
            </div>
            <div id="editRoleField" class="mb-3" style="display: none;">
              <label for="editRole" class="form-label">Role *</label>
              <input type="text" class="form-control" id="editRole">
            </div>
            <div id="editAddressField" class="mb-3" style="display: none;">
              <label for="editAddress" class="form-label">Address</label>
              <input type="text" class="form-control" id="editAddress">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="submitProfileEdit()">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="changePasswordModalLabel">Change Password</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="changePasswordForm">
            <div class="mb-3">
              <label for="currentPassword" class="form-label">Current Password *</label>
              <input type="password" class="form-control" id="currentPassword" required>
            </div>
            <div class="mb-3">
              <label for="newPassword" class="form-label">New Password *</label>
              <input type="password" class="form-control" id="newPassword" required minlength="6">
            </div>
            <div class="mb-3">
              <label for="confirmNewPassword" class="form-label">Confirm New Password *</label>
              <input type="password" class="form-control" id="confirmNewPassword" required>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="submitPasswordChange()">Change Password</button>
        </div>
      </div>
    </div>
  </div>

  <footer class="mt-5">
    <div class="container">
      <p class="mb-0">&copy; 2024 Campus ReHome - CollegeTown Furniture Platform | Roll Tide! üêò</p>
    </div>
  </footer>

  <!-- Bootstrap 5 JS Bundle -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>
  
  <script>
    // Get API base URL
    function getApiBaseUrl() {
      if (window.location.protocol === 'file:') {
        return 'http://localhost:5000/api';
      }
      return '/api';
    }

    // Check authentication
    const userToken = localStorage.getItem('userToken');
    const userId = localStorage.getItem('userId');
    const userType = localStorage.getItem('userType');

    if (!userToken || !userId || !userType) {
      window.location.href = './login.html';
    }

    // Add employee navigation items ONLY if user is an employee
    console.log('User Type:', userType); // Debug log
    
    // First, ensure any existing employee nav items are removed
    const existingFurniture = document.getElementById('furnitureNavItem');
    const existingCustomers = document.getElementById('customersNavItem');
    const existingEmployees = document.getElementById('employeesNavItem');
    const existingTransactions = document.getElementById('transactionsNavItem');
    
    if (existingFurniture) existingFurniture.remove();
    if (existingCustomers) existingCustomers.remove();
    if (existingEmployees) existingEmployees.remove();
    if (existingTransactions) existingTransactions.remove();
    
    // Only add them back if user is explicitly an employee
    if (userType && userType.toLowerCase() === 'employee') {
      console.log('Employee user - adding employee nav items');
      
      // Add the nav items for employees
      const navList = document.querySelector('.navbar-nav.ms-auto');
      if (navList) {
        const homeItem = navList.querySelector('li:first-child');
        if (homeItem) {
          const furnitureNav = document.createElement('li');
          furnitureNav.className = 'nav-item';
          furnitureNav.id = 'furnitureNavItem';
          furnitureNav.innerHTML = '<a class="nav-link" href="./furniture.html"><i class="bi bi-furniture"></i> Furniture</a>';
          homeItem.after(furnitureNav);
          
          const customersNav = document.createElement('li');
          customersNav.className = 'nav-item';
          customersNav.id = 'customersNavItem';
          customersNav.innerHTML = '<a class="nav-link" href="./customers.html"><i class="bi bi-people"></i> Customers</a>';
          furnitureNav.after(customersNav);
          
          const employeesNav = document.createElement('li');
          employeesNav.className = 'nav-item';
          employeesNav.id = 'employeesNavItem';
          employeesNav.innerHTML = '<a class="nav-link" href="./employees.html"><i class="bi bi-person-badge"></i> Employees</a>';
          customersNav.after(employeesNav);
          
          const transactionsNav = document.createElement('li');
          transactionsNav.className = 'nav-item';
          transactionsNav.id = 'transactionsNavItem';
          transactionsNav.innerHTML = '<a class="nav-link" href="./transactions.html"><i class="bi bi-receipt"></i> Transactions</a>';
          employeesNav.after(transactionsNav);
        }
      }
    } else {
      console.log('Customer user - employee nav items will NOT be added');
      // Double-check: remove any that might exist
      setTimeout(() => {
        const checkFurniture = document.getElementById('furnitureNavItem');
        const checkCustomers = document.getElementById('customersNavItem');
        const checkEmployees = document.getElementById('employeesNavItem');
        const checkTransactions = document.getElementById('transactionsNavItem');
        if (checkFurniture) checkFurniture.remove();
        if (checkCustomers) checkCustomers.remove();
        if (checkEmployees) checkEmployees.remove();
        if (checkTransactions) checkTransactions.remove();
      }, 100);
    }

    // Load profile data
    async function loadProfile() {
      try {
        const endpoint = userType === 'employee' ? 'employees' : 'customers';
        const response = await fetch(`${getApiBaseUrl()}/${endpoint}/${userId}`);
        
        if (!response.ok) {
          throw new Error('Failed to load profile');
        }
        
        const data = await response.json();
        // Handle snake_case response
        const user = {
          customer_id: data.customer_id || data.customerId,
          employee_id: data.employee_id || data.employeeId,
          first_name: data.first_name || data.firstName,
          last_name: data.last_name || data.lastName,
          email: data.email,
          phone: data.phone,
          phone_number: data.phone_number || data.phoneNumber,
          address: data.address,
          role: data.role,
          hire_date: data.hire_date || data.hireDate,
          join_date: data.join_date || data.joinDate,
          is_active: data.is_active !== undefined ? data.is_active : data.isActive
        };
        displayProfile(user);
      } catch (error) {
        console.error('Error loading profile:', error);
        document.getElementById('profileLoading').style.display = 'none';
        document.getElementById('profileError').textContent = 'Error loading profile. Please try again.';
        document.getElementById('profileError').style.display = 'block';
      }
    }

    function displayProfile(user) {
      document.getElementById('profileId').textContent = userType === 'employee' ? user.employee_id : user.customer_id;
      document.getElementById('profileName').textContent = `${user.first_name} ${user.last_name}`;
      document.getElementById('profileEmail').textContent = user.email;
      document.getElementById('profilePhone').textContent = user.phone || user.phone_number || '-';
      
      if (userType === 'employee') {
        document.getElementById('profileRoleRow').style.display = 'flex';
        document.getElementById('profileRole').textContent = user.role;
        document.getElementById('editRoleField').style.display = 'block';
        document.getElementById('editRole').value = user.role;
        
        if (user.hire_date) {
          document.getElementById('profileHireDateRow').style.display = 'flex';
          document.getElementById('profileHireDate').textContent = new Date(user.hire_date).toLocaleDateString();
        }
        
        document.getElementById('profileStatusRow').style.display = 'flex';
        document.getElementById('profileStatus').innerHTML = user.is_active 
          ? '<span class="badge bg-success">Active</span>'
          : '<span class="badge bg-secondary">Inactive</span>';
      } else {
        document.getElementById('profileAddressRow').style.display = 'flex';
        document.getElementById('profileAddress').textContent = user.address || '-';
        document.getElementById('editAddressField').style.display = 'block';
        document.getElementById('editAddress').value = user.address || '';
        
        if (user.join_date) {
          document.getElementById('profileJoinDateRow').style.display = 'flex';
          document.getElementById('profileJoinDate').textContent = new Date(user.join_date).toLocaleDateString();
        }
      }
      
      // Populate edit form
      document.getElementById('editFirstName').value = user.first_name;
      document.getElementById('editLastName').value = user.last_name;
      document.getElementById('editEmail').value = user.email;
      document.getElementById('editPhone').value = user.phone || user.phone_number || '';
      
      document.getElementById('profileLoading').style.display = 'none';
      document.getElementById('profileContent').style.display = 'block';
      
      // Load transaction history for customers
      if (userType === 'customer') {
        const customerId = user.customer_id || userId;
        console.log('Loading transactions for customer ID:', customerId, 'user object:', user);
        if (customerId) {
          loadCustomerTransactions(customerId);
        } else {
          console.error('No customer ID found - user:', user, 'userId:', userId);
        }
      }
    }

    async function loadCustomerTransactions(customerId) {
      try {
        document.getElementById('transactionHistorySection').style.display = 'block';
        document.getElementById('transactionsLoading').style.display = 'block';
        document.getElementById('transactionsContent').style.display = 'none';
        document.getElementById('transactionsError').style.display = 'none';
        
        const url = `${getApiBaseUrl()}/transactions/customer/${customerId}`;
        console.log('Loading transactions from:', url);
        
        const response = await fetch(url);
        
        if (!response.ok) {
          const errorText = await response.text();
          console.error('API Error:', response.status, errorText);
          throw new Error(`Failed to load transactions: ${response.status} ${errorText}`);
        }
        
        const data = await response.json();
        console.log('Transactions data:', data);
        const transactions = data.transactions || [];
        
        displayCustomerTransactions(transactions);
      } catch (error) {
        console.error('Error loading transactions:', error);
        document.getElementById('transactionsLoading').style.display = 'none';
        document.getElementById('transactionsError').textContent = `Error loading order history: ${error.message}. Please try again.`;
        document.getElementById('transactionsError').style.display = 'block';
      }
    }

    function displayCustomerTransactions(transactions) {
      const transactionsList = document.getElementById('transactionsList');
      
      if (transactions.length === 0) {
        transactionsList.innerHTML = '<p class="text-muted text-center">No orders yet. Start shopping to see your order history here!</p>';
        document.getElementById('transactionsLoading').style.display = 'none';
        document.getElementById('transactionsContent').style.display = 'block';
        return;
      }
      
      transactionsList.innerHTML = transactions.map(transaction => {
        const date = new Date(transaction.transaction_date || transaction.transactionDate).toLocaleDateString();
        const statusClass = transaction.status === 'Completed' ? 'bg-success' : 
                           transaction.status === 'Pending' ? 'bg-warning' : 'bg-secondary';
        const statusTextColor = transaction.status === 'Pending' ? 'text-dark' : '';
        
        // Build items list
        const details = transaction.details || transaction.Details || [];
        const itemsList = details.length > 0 
          ? details.map(detail => {
              const itemName = detail.furniture_name || detail.furnitureName || `Item #${detail.furniture_id || detail.furnitureId}`;
              const quantity = detail.quantity || detail.Quantity || 0;
              const price = parseFloat(detail.sale_price || detail.salePrice || detail.SalePrice || 0).toFixed(2);
              return `<li>${itemName} √ó ${quantity} - $${price}</li>`;
            }).join('')
          : '<li>No items found</li>';
        
        return `
          <div class="card mb-3">
            <div class="card-body">
              <div class="row">
                <div class="col-md-8">
                  <h5 class="card-title">Order #${transaction.transaction_id || transaction.transactionId}</h5>
                  <p class="text-muted mb-2"><strong>Date:</strong> ${date}</p>
                  <p class="text-muted mb-2"><strong>Payment Method:</strong> ${transaction.payment_method || transaction.paymentMethod}</p>
                  <p class="mb-2"><strong>Items:</strong></p>
                  <ul class="mb-0">${itemsList}</ul>
                </div>
                <div class="col-md-4 text-end">
                  <h4 class="text-primary mb-3">$${parseFloat(transaction.total_amount || transaction.totalAmount || 0).toFixed(2)}</h4>
                  <span class="badge ${statusClass} ${statusTextColor} fs-6">${transaction.status}</span>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');
      
      document.getElementById('transactionsLoading').style.display = 'none';
      document.getElementById('transactionsContent').style.display = 'block';
    }

    async function submitProfileEdit() {
      const form = document.getElementById('editProfileForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const endpoint = userType === 'employee' ? 'employees' : 'customers';
      
      // Get current user data to preserve password and other fields
      try {
        const getResponse = await fetch(`${getApiBaseUrl()}/${endpoint}/${userId}`);
        if (!getResponse.ok) {
          throw new Error('Failed to load user data');
        }
        
        const userData = await getResponse.json();
        const user = {
          first_name: userData.first_name || userData.firstName,
          last_name: userData.last_name || userData.lastName,
          email: userData.email,
          phone: userData.phone,
          phone_number: userData.phone_number || userData.phoneNumber,
          address: userData.address,
          role: userData.role,
          hire_date: userData.hire_date || userData.hireDate,
          is_active: userData.is_active !== undefined ? userData.is_active : userData.isActive,
          userpassword: userData.userpassword || userData.userPassword
        };
        
        const updateData = {
          FirstName: document.getElementById('editFirstName').value,
          LastName: document.getElementById('editLastName').value,
          Email: document.getElementById('editEmail').value,
          UserPassword: user.userpassword // Keep existing password
        };

        if (userType === 'employee') {
          updateData.PhoneNumber = document.getElementById('editPhone').value || null;
          updateData.Role = document.getElementById('editRole').value;
          updateData.HireDate = user.hire_date || null;
          updateData.IsActive = user.is_active !== undefined ? user.is_active : true;
        } else {
          updateData.Phone = document.getElementById('editPhone').value || null;
          updateData.Address = document.getElementById('editAddress').value || null;
        }

        const response = await fetch(`${getApiBaseUrl()}/${endpoint}/${userId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(updateData)
        });

        if (!response.ok) {
          throw new Error('Failed to update profile');
        }

        // Close modal and reload profile
        const modal = bootstrap.Modal.getInstance(document.getElementById('editProfileModal'));
        modal.hide();
        loadProfile();
        alert('Profile updated successfully!');
      } catch (error) {
        console.error('Error updating profile:', error);
        alert('Error updating profile: ' + error.message);
      }
    }

    async function submitPasswordChange() {
      const form = document.getElementById('changePasswordForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmNewPassword').value;

      if (newPassword !== confirmPassword) {
        alert('New passwords do not match');
        return;
      }

      const endpoint = userType === 'employee' ? 'employees' : 'customers';
      
      try {
        // Get current user data first
        const getResponse = await fetch(`${getApiBaseUrl()}/${endpoint}/${userId}`);
        if (!getResponse.ok) {
          throw new Error('Failed to load user data');
        }
        
        const userData = await getResponse.json();
        // Handle snake_case response
        const user = {
          first_name: userData.first_name || userData.firstName,
          last_name: userData.last_name || userData.lastName,
          email: userData.email,
          phone: userData.phone,
          phone_number: userData.phone_number || userData.phoneNumber,
          address: userData.address,
          role: userData.role,
          hire_date: userData.hire_date || userData.hireDate,
          is_active: userData.is_active !== undefined ? userData.is_active : userData.isActive
        };
        
        const updateData = {
          FirstName: user.first_name,
          LastName: user.last_name,
          Email: user.email,
          UserPassword: newPassword
        };

        if (userType === 'employee') {
          updateData.PhoneNumber = user.phone_number || null;
          updateData.Role = user.role;
          updateData.HireDate = user.hire_date || null;
          updateData.IsActive = user.is_active !== undefined ? user.is_active : true;
        } else {
          updateData.Phone = user.phone || null;
          updateData.Address = user.address || null;
        }

        const response = await fetch(`${getApiBaseUrl()}/${endpoint}/${userId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(updateData)
        });

        if (!response.ok) {
          throw new Error('Failed to change password');
        }

        const modal = bootstrap.Modal.getInstance(document.getElementById('changePasswordModal'));
        modal.hide();
        form.reset();
        alert('Password changed successfully!');
      } catch (error) {
        console.error('Error changing password:', error);
        alert('Error changing password: ' + error.message);
      }
    }

    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('userToken');
        localStorage.removeItem('userId');
        localStorage.removeItem('userType');
        localStorage.removeItem('userName');
        localStorage.removeItem('userEmail');
        window.location.href = './index.html';
      }
    }

    // Load profile on page load
    loadProfile();
  </script>
</body>
</html>

